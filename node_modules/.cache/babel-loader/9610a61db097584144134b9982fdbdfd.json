{"ast":null,"code":"var _jsxFileName = \"/Users/altafquadri/Development/code/Mod5Project/Frontend/lead-us-react/src/containers/LeadActivityContainer.js\";\nimport React from 'react';\nimport './LeadActivityContainer.css';\nimport ShowLeadContainer from './ShowLeadContainer';\nimport CallsContainer from './CallsContainer';\nimport CallForm from '../components/CallForm';\nimport AppointmentsContainer from './AppointmentsContainer';\nimport AppointmentForm from '../components/AppointmentForm';\nimport Map from './Map';\nimport AppointmentUpdateForm from '../components/AppointmentUpdateForm';\nconst callsApi = 'http://localhost:3000/api/v1/calls';\nconst leadUpdateApi = 'http://localhost:3000/api/v1/leads';\nconst callsApiUpdate = 'http://localhost:3000/api/v1/calls';\nconst appointmentsApi = 'http://localhost:3000/api/v1/appointments';\n\nclass LeadActivityContainer extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      //for both\n      user_id: '',\n      lead_id: this.props.lead.id,\n      //for calls\n      callForm: false,\n      appointmentForm: false,\n      call_status: \"No Answer\",\n      'appointment_made?': false,\n      'archive_lead?': false,\n      callsSubmitted: false,\n      //for appointments\n      title: \"\",\n      date: \"\",\n      start_time: \"\",\n      end_time: \"\",\n      // 'presentation_made?': false,\n      // 'made_sale?': false,\n      //to get call id in case appointment is not set\n      callId: '',\n      //edit appointment form\n      editAppointment: false,\n      clickedEditAppointment: ''\n    };\n\n    this.setInitialState = () => {\n      this.setState({\n        user_id: this.props.currentUser.id,\n        lead_id: this.props.lead.id,\n        callForm: false,\n        appointmentForm: false,\n        call_status: \"No Answer\",\n        'appointment_made?': false,\n        'archive_lead?': false,\n        callsSubmitted: false,\n        title: \"\",\n        date: \"\",\n        start_time: \"\",\n        end_time: \"\",\n        editAppointment: false,\n        clickedEditAppointment: ''\n      });\n    };\n\n    this.editAppointmentFormAfterSubmit = () => {\n      this.setState({\n        editAppointment: !this.state.editAppointment\n      });\n    };\n\n    this.noAppUpdate = e => {\n      e.preventDefault();\n      fetch(callsApiUpdate + '/' + this.state.callId, {\n        method: 'PATCH',\n        headers: {\n          'Content-type': 'application/json',\n          Accepts: 'application/json'\n        },\n        body: JSON.stringify({\n          id: this.state.callId,\n          'appointment_made?': false\n        })\n      }).then(res => res.json()).then(call => {\n        this.props.editCallNoApp(call);\n        this.setInitialState();\n      });\n    };\n\n    this.setAppointmentState = () => {\n      this.setState({\n        user_id: this.props.currentUser.id,\n        lead_id: this.props.lead.id,\n        callForm: false,\n        appointmentForm: true,\n        call_status: \"No Answer\",\n        'appointment_made?': false,\n        'archive_lead?': false,\n        callsSubmitted: true,\n        title: \"\",\n        date: \"\",\n        start_time: \"\",\n        end_time: \"\"\n      });\n    };\n\n    this.onPhoneClick = () => {\n      this.setState({\n        callForm: !this.state.callForm,\n        lead_id: this.props.lead.id\n      });\n    };\n\n    this.onEditAppointmentClick = appointment => {\n      this.setState({\n        editAppointment: !this.state.editAppointment,\n        clickedEditAppointment: appointment\n      });\n    };\n\n    this.onFormChange = e => {\n      this.setState({\n        call_status: e.target.value\n      });\n    };\n\n    this.onToggleArchive = () => {\n      this.setState({\n        'archive_lead?': !this.state['archive_lead?']\n      });\n    };\n\n    this.onToggleAppointment = () => {\n      this.setState({\n        'appointment_made?': !this.state['appointment_made?']\n      });\n    };\n\n    this.onFormSubmission = e => {\n      e.preventDefault();\n\n      if (this.state['appointment_made?'] === false) {\n        fetch(callsApi, {\n          method: 'POST',\n          headers: {\n            \"Content-type\": 'application/json',\n            Accepts: 'application/json'\n          },\n          body: JSON.stringify({\n            user_id: this.state.user_id,\n            lead_id: this.state.lead_id,\n            call_status: this.state.call_status,\n            'appointment_made?': this.state['appointment_made?'],\n            'archive_lead?': this.state['archive_lead?']\n          })\n        }).then(resp => resp.json()).then(call => {\n          this.props.addNewCall(call);\n          this.setInitialState();\n          this.setState({\n            callsSubmitted: true\n          });\n\n          if (call['archive_lead?']) {\n            fetch(leadUpdateApi + '/' + this.state.lead.id, {\n              method: 'PATCH',\n              headers: {\n                'Content-type': 'application/json',\n                Accepts: 'application/json'\n              },\n              body: JSON.stringify({\n                id: this.state.lead.id,\n                'lead_archived?': true\n              })\n            }).then(res);\n          }\n        });\n      } else if (this.state['appointment_made?']) {\n        fetch(callsApi, {\n          method: 'POST',\n          headers: {\n            \"Content-type\": 'application/json',\n            Accepts: 'application/json'\n          },\n          body: JSON.stringify({\n            user_id: this.state.user_id,\n            lead_id: this.state.lead_id,\n            call_status: this.state.call_status,\n            'appointment_made?': this.state['appointment_made?'],\n            'archive_lead?': this.state['archive_lead?']\n          })\n        }).then(resp => resp.json()).then(call => {\n          this.props.addNewCall(call);\n          this.setAppointmentState();\n          this.setState({\n            callId: call.id\n          });\n        });\n      }\n    };\n\n    this.onAppointmentSubmit = e => {\n      e.preventDefault();\n      let newStartTime = this.state.date + 'T' + this.state.start_time;\n      let newEndTime = this.state.date + 'T' + this.state.end_time;\n      fetch(appointmentsApi, {\n        method: 'POST',\n        headers: {\n          'Content-type': 'application/json',\n          Accepts: 'application/json'\n        },\n        body: JSON.stringify({\n          user_id: this.state.user_id,\n          lead_id: this.state.lead_id,\n          title: this.state.title,\n          date: this.state.date,\n          start_time: newStartTime,\n          end_time: newEndTime\n        })\n      }).then(res => res.json()).then(appointment => this.props.addNewAppointment(appointment));\n      this.setInitialState();\n    };\n\n    this.partialFormHandler = e => {\n      this.setState({\n        [e.target.name]: e.target.value\n      });\n    };\n  }\n\n  componentDidMount() {\n    let newState = this.props.currentUser === null ? localStorage.user_id : this.props.currentUser.id; // console.log(\"i am newstate:\",newState)\n\n    this.setState({\n      user_id: newState\n    });\n  }\n\n  render() {\n    // console.log('I am from props in leadActCont',this.props)\n    // console.log('I am from state in leadActCont',this.state)\n    // console.log(\"i am localstorage:\" ,localStorage.user_id)\n    return React.createElement(\"div\", {\n      className: \"activity-show-page\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"lead-show-page\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    }, React.createElement(ShowLeadContainer, {\n      lead: this.props.lead,\n      onPhoneClick: this.onPhoneClick,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    }), React.createElement(CallsContainer, {\n      calls: this.props.calls,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239\n      },\n      __self: this\n    }), React.createElement(AppointmentsContainer, {\n      clickedLeadAppointments: this.props.clickedLeadAppointments,\n      onEditAppointmentClick: this.onEditAppointmentClick,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    })), this.state.callForm && !this.state.appointmentForm ? React.createElement(CallForm, {\n      calls: this.props.calls,\n      formData: this.state,\n      onToggleArchive: this.onToggleArchive,\n      onFormSubmission: this.onFormSubmission,\n      onToggleAppointment: this.onToggleAppointment,\n      onFormChange: this.onFormChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }) : null, this.state.appointmentForm ? React.createElement(AppointmentForm, {\n      formData: this.state,\n      partialFormHandler: this.partialFormHandler,\n      noAppUpdate: this.noAppUpdate,\n      onAppointmentSubmit: this.onAppointmentSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255\n      },\n      __self: this\n    }) : null, this.state.editAppointment ? React.createElement(AppointmentUpdateForm // formData={this.state}\n    // onTogglePresentation={this.onTogglePresentation}\n    // onToggleSale={this.onToggleSale}\n    , {\n      editTheAppointment: this.props.editTheAppointment,\n      editAppointmentFormAfterSubmit: this.editAppointmentFormAfterSubmit,\n      clickedEditAppointment: this.state.clickedEditAppointment,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263\n      },\n      __self: this\n    }) : null, React.createElement(\"div\", {\n      className: \"map-div\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272\n      },\n      __self: this\n    }, React.createElement(Map, {\n      lead: this.props.lead,\n      user: this.props.currentUser,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default LeadActivityContainer;","map":{"version":3,"sources":["/Users/altafquadri/Development/code/Mod5Project/Frontend/lead-us-react/src/containers/LeadActivityContainer.js"],"names":["React","ShowLeadContainer","CallsContainer","CallForm","AppointmentsContainer","AppointmentForm","Map","AppointmentUpdateForm","callsApi","leadUpdateApi","callsApiUpdate","appointmentsApi","LeadActivityContainer","Component","state","user_id","lead_id","props","lead","id","callForm","appointmentForm","call_status","callsSubmitted","title","date","start_time","end_time","callId","editAppointment","clickedEditAppointment","setInitialState","setState","currentUser","editAppointmentFormAfterSubmit","noAppUpdate","e","preventDefault","fetch","method","headers","Accepts","body","JSON","stringify","then","res","json","call","editCallNoApp","setAppointmentState","onPhoneClick","onEditAppointmentClick","appointment","onFormChange","target","value","onToggleArchive","onToggleAppointment","onFormSubmission","resp","addNewCall","onAppointmentSubmit","newStartTime","newEndTime","addNewAppointment","partialFormHandler","name","componentDidMount","newState","localStorage","render","calls","clickedLeadAppointments","editTheAppointment"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './LeadActivityContainer.css'\nimport ShowLeadContainer from './ShowLeadContainer';\nimport CallsContainer from './CallsContainer';\nimport CallForm from '../components/CallForm'\nimport AppointmentsContainer from './AppointmentsContainer';\nimport AppointmentForm from '../components/AppointmentForm'\nimport Map from './Map'\nimport AppointmentUpdateForm from '../components/AppointmentUpdateForm';\n\nconst callsApi = 'http://localhost:3000/api/v1/calls'\nconst leadUpdateApi = 'http://localhost:3000/api/v1/leads'\nconst callsApiUpdate = 'http://localhost:3000/api/v1/calls'\nconst appointmentsApi = 'http://localhost:3000/api/v1/appointments'\n\nclass LeadActivityContainer extends React.Component {\n    state = { \n\n        //for both\n        user_id: '',\n        lead_id: this.props.lead.id,\n\n        //for calls\n        callForm: false,\n        appointmentForm: false,\n        call_status: \"No Answer\",\n        'appointment_made?': false,\n        'archive_lead?': false,\n        callsSubmitted: false,\n\n        //for appointments\n        title: \"\",\n        date: \"\",\n        start_time: \"\",\n        end_time: \"\",\n        // 'presentation_made?': false,\n        // 'made_sale?': false,\n\n        //to get call id in case appointment is not set\n        callId: '',\n\n        //edit appointment form\n        editAppointment: false,\n        clickedEditAppointment: ''\n\n    }\n\n    setInitialState = () => {\n        this.setState({ \n            user_id: this.props.currentUser.id, \n            lead_id: this.props.lead.id,\n            callForm: false,\n            appointmentForm: false,\n            call_status: \"No Answer\",\n            'appointment_made?': false,\n            'archive_lead?': false,\n            callsSubmitted: false,\n\n            title: \"\",\n            date: \"\",\n            start_time: \"\",\n            end_time: \"\",\n            editAppointment: false,\n            clickedEditAppointment: ''\n        });\n    }\n\n    editAppointmentFormAfterSubmit = () => {\n        this.setState({ editAppointment: !this.state.editAppointment });\n    }\n\n    noAppUpdate = (e) => {\n        e.preventDefault()\n        fetch(callsApiUpdate + '/' + this.state.callId, {\n            method: 'PATCH',\n            headers: {\n                'Content-type': 'application/json',\n                Accepts: 'application/json'\n            },\n            body: JSON.stringify({\n                id: this.state.callId,\n                'appointment_made?': false\n            })\n        }).then(res => res.json()).then(call => {\n            this.props.editCallNoApp(call)\n            this.setInitialState()\n        })\n    }\n\n        setAppointmentState = () => {\n        this.setState({ \n            user_id: this.props.currentUser.id, \n            lead_id: this.props.lead.id,\n            callForm: false,\n            appointmentForm: true,\n            call_status: \"No Answer\",\n            'appointment_made?': false,\n            'archive_lead?': false,\n            callsSubmitted: true,\n\n            title: \"\",\n            date: \"\",\n            start_time: \"\",\n            end_time: \"\",\n        });\n    }\n\n    onPhoneClick = () => {\n        this.setState(\n        { \n            callForm: !this.state.callForm,\n            lead_id: this.props.lead.id\n        });\n    }\n\n    onEditAppointmentClick = (appointment) => {\n        this.setState(\n            { \n                editAppointment: !this.state.editAppointment,\n                clickedEditAppointment: appointment \n            })\n    } \n\n    onFormChange = (e) => {\n        this.setState({ call_status: e.target.value  });\n    }\n\n    onToggleArchive = () => {\n        this.setState({ 'archive_lead?': !this.state['archive_lead?']  });\n    }\n\n    onToggleAppointment = () => {\n        this.setState({ 'appointment_made?': !this.state['appointment_made?']  });\n    }\n\n    onFormSubmission = (e) => {\n        e.preventDefault()\n\n        if (this.state['appointment_made?'] === false) {\n            fetch(callsApi, {\n                method: 'POST',\n                headers: {\n                    \"Content-type\": 'application/json',\n                    Accepts: 'application/json'\n                },\n                body: JSON.stringify({\n                    user_id: this.state.user_id,\n                    lead_id: this.state.lead_id,\n                    call_status: this.state.call_status,\n                    'appointment_made?': this.state['appointment_made?'],\n                    'archive_lead?': this.state['archive_lead?']\n                })\n            }).then(resp => resp.json()).then(call => {\n                this.props.addNewCall(call)\n                this.setInitialState()\n                this.setState({ callsSubmitted: true  })\n                if (call['archive_lead?']) {\n                    fetch(leadUpdateApi + '/' + this.state.lead.id, {\n                        method: 'PATCH',\n                        headers: {\n                            'Content-type': 'application/json',\n                            Accepts: 'application/json'\n                        },\n                        body: JSON.stringify({\n                            id: this.state.lead.id,\n                            'lead_archived?': true\n                        })\n                    }).then(res)\n\n                }\n            })\n\n        } else if (this.state['appointment_made?']) {\n            fetch(callsApi, {\n                method: 'POST',\n                headers: {\n                    \"Content-type\": 'application/json',\n                    Accepts: 'application/json'\n                },\n                body: JSON.stringify({\n                    user_id: this.state.user_id,\n                    lead_id: this.state.lead_id,\n                    call_status: this.state.call_status,\n                    'appointment_made?': this.state['appointment_made?'],\n                    'archive_lead?': this.state['archive_lead?']\n                })\n            }).then(resp => resp.json()).then(call => {\n                this.props.addNewCall(call)\n                this.setAppointmentState()\n                this.setState({ callId: call.id });\n            })    \n        }\n    }\n\n    onAppointmentSubmit = (e) => {\n        e.preventDefault()\n        let newStartTime = this.state.date + 'T' + this.state.start_time\n        let newEndTime = this.state.date + 'T' + this.state.end_time\n\n        fetch(appointmentsApi, {\n            method: 'POST',\n            headers: {\n                'Content-type': 'application/json',\n                Accepts: 'application/json'\n            },\n            body: JSON.stringify({\n                user_id: this.state.user_id,\n                lead_id: this.state.lead_id,\n                title: this.state.title,\n                date: this.state.date,\n                start_time: newStartTime,\n                end_time: newEndTime\n            })\n        }).then(res => res.json()).then(appointment => this.props.addNewAppointment(appointment))\n        this.setInitialState()\n    }\n\n    partialFormHandler = (e) => {\n        this.setState({ [e.target.name]: e.target.value  });\n    }\n\n    componentDidMount() {\n\n        let newState = (this.props.currentUser === null ? localStorage.user_id :this.props.currentUser.id )\n        // console.log(\"i am newstate:\",newState)\n        this.setState({ user_id: newState   });\n    }\n\n    \n\n    render() { \n        // console.log('I am from props in leadActCont',this.props)\n        // console.log('I am from state in leadActCont',this.state)\n        // console.log(\"i am localstorage:\" ,localStorage.user_id)\n        return ( \n            <div className=\"activity-show-page\">\n                <div className=\"lead-show-page\">\n                    <ShowLeadContainer lead={this.props.lead} onPhoneClick={this.onPhoneClick}/>\n                    <CallsContainer calls={this.props.calls} />\n                    <AppointmentsContainer \n                    clickedLeadAppointments={this.props.clickedLeadAppointments}\n                    onEditAppointmentClick={this.onEditAppointmentClick}/>\n                </div>\n\n                {/* call form is true and appointment form is false just show call form, if appointment \n                form is true upon submission, do not show the call form */}\n                {this.state.callForm  && !this.state.appointmentForm ? <CallForm calls={this.props.calls} \n                formData={this.state}\n                onToggleArchive={this.onToggleArchive}\n                onFormSubmission={this.onFormSubmission}\n                onToggleAppointment={this.onToggleAppointment}\n                onFormChange={this.onFormChange}/> : null }\n\n                {/* appointment form is true just show appoinment form} */}\n                {this.state.appointmentForm ? <AppointmentForm formData={this.state}\n                partialFormHandler={this.partialFormHandler}\n                \n                noAppUpdate={this.noAppUpdate}\n                onAppointmentSubmit={this.onAppointmentSubmit}\n                /> : null}\n\n                {/* edit appointment form */}\n                {this.state.editAppointment ? <AppointmentUpdateForm\n                // formData={this.state}\n                // onTogglePresentation={this.onTogglePresentation}\n                // onToggleSale={this.onToggleSale}\n                editTheAppointment={this.props.editTheAppointment}\n                editAppointmentFormAfterSubmit={this.editAppointmentFormAfterSubmit}\n                clickedEditAppointment={this.state.clickedEditAppointment}\n                /> :null}\n\n                <div className=\"map-div\">\n                    <Map lead={this.props.lead} user={this.props.currentUser}/>\n                </div>\n\n            </div>\n                \n            );\n        }\n    }\n    \n    export default LeadActivityContainer;"]},"metadata":{},"sourceType":"module"}