{"ast":null,"code":"import _objectSpread from\"/Users/altafquadri/Development/code/Mod5Project/Frontend/lead-us-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/altafquadri/Development/code/Mod5Project/Frontend/lead-us-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/altafquadri/Development/code/Mod5Project/Frontend/lead-us-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/altafquadri/Development/code/Mod5Project/Frontend/lead-us-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/altafquadri/Development/code/Mod5Project/Frontend/lead-us-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/altafquadri/Development/code/Mod5Project/Frontend/lead-us-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/altafquadri/Development/code/Mod5Project/Frontend/lead-us-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import moment from'moment';import WeeklyAppointmentsMetric from'../components/WeeklyAppointmentsMetric';import WeeklyProduction from'../components/WeeklyProduction';import'./MetricsContainer.css';var MetricsContainer=/*#__PURE__*/function(_React$Component){_inherits(MetricsContainer,_React$Component);function MetricsContainer(){var _getPrototypeOf2;var _this;_classCallCheck(this,MetricsContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(MetricsContainer)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={currentUser:[],sales:[],currentDate:moment(),appointments:[],appointmentDates:[],filteredAppointmentDatesByWeek:[],daysOfWeek:[],countOfApptInDaysOfWeek:[],lineChartData:{},weekAppointments:[],presentations:[],weeklySales:[],polarChartData:{},weeklyFilteredSales:[],salesAmount:0};_this.getDaysOfTheWeek=function(){var beginningOfWeek=moment().startOf('week');var daysOfWeek=[];//used knowledge of today's date and the start of the week to iterate days to the end of the week\ndaysOfWeek.push(beginningOfWeek.format('YYYY-MM-DD'));for(var i=1;i<7;i++){daysOfWeek.push(beginningOfWeek.add(1,'days').format('YYYY-MM-DD'));}return daysOfWeek;};_this.countOfApptInDaysOfWeek=function(a,b){var counts=[];for(var i=0;i<a.length;i++){// initialize all the current week's days to a count of zero\nvar count=0;for(var j=0;j<b.length;j++){//if there is a date that matches the current weekday, then increment that date's count by 1\nif(moment(b[j]).isSame(moment(a[i]))){count++;}}counts.push(count);}return counts;};_this.getWeeklyPresentations=function(){var filteredAppointmentsByWeek=_this.state.appointments.filter(function(appointment){return moment(appointment.date).isSame(_this.state.currentDate,'week');});var salesonWeeklyAppointments=filteredAppointmentsByWeek.filter(function(appointment){return appointment['made_sale?'];});_this.setState({weekAppointments:filteredAppointmentsByWeek,weeklySales:salesonWeeklyAppointments},function(){return _this.setState({polarChartData:_this.setPolarChartData()});});var presentationAppointments=filteredAppointmentsByWeek.filter(function(appointment){return appointment['presentation_made?'];});return presentationAppointments;};_this.setLineChartData=function(){var chartData={labels:_this.state.daysOfWeek,datasets:[{label:\"\".concat(_this.state.filteredAppointmentDatesByWeek.length,\" Appointments for the week\"),data:_this.state.countOfApptInDaysOfWeek,backgroundColor:['rgba(48, 1, 30, 0.4)','rgba(54, 162, 235, 0.2)','rgba(255, 206, 86, 0.2)','rgba(75, 192, 192, 0.2)','rgba(153, 102, 255, 0.2)'],borderColor:['rgba(255, 99, 132, 1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)','rgba(153, 102, 255, 1)'],borderWidth:1}]};return chartData;};_this.setPolarChartData=function(){var polarChartData={labels:['Appointments','Presentations','Sales'],datasets:[{label:\"$Weekly Presentation\",data:[_this.state.weekAppointments.length,_this.state.presentations.length,_this.state.weeklySales.length],backgroundColor:['rgba(48, 1, 30, 0.8)','rgba(80, 81, 79, 0.8)','rgba(203, 212, 194, 0.8)','rgba(255, 206, 86, 0.2)','rgba(75, 192, 192, 0.2)'],borderColor:['rgba(255, 99, 132, 1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)','rgba(153, 102, 255, 1)'],borderWidth:1}]};return polarChartData;};_this.getSalesForTheCurrentWeek=function(a,b){// if (a === undefined || b === undefined) return //needed this guard condition when I had the metrics container split amongst other classes\nvar sales=a;// total of all sales user has\nvar weekSales=b;// all this current week sales\nvar weekSalesids=weekSales.map(function(wSale){return wSale.lead_id;});//week sales are all the appointments\nvar weeklyFilteredSales=sales.filter(function(sale){return weekSalesids.includes(sale.lead_id);});// want all of the total sales that correspond to the week\n_this.setState({weeklyFilteredSales:_toConsumableArray(weeklyFilteredSales)});//sum up all the annualized life premiums for the week\nvar salesAmount=weeklyFilteredSales.reduce(function(total,alp){return total+alp.annualized_life_premium;},0);_this.setState({salesAmount:salesAmount});};return _this;}_createClass(MetricsContainer,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.setState({currentUser:this.props.currentUser,appointments:this.props.appointments,sales:this.props.sales},function(){return _this2.setState({presentations:_this2.getWeeklyPresentations()});});var newDates,filteredAppointmentDatesByWeek;//take all appointments\nnewDates=this.props.appointments.map(function(appointment){return appointment.date;});//take appointments and filter them by current week\n//compare today's date with the array of appointments\nfilteredAppointmentDatesByWeek=newDates.filter(function(date){return moment(date).isSame(_this2.state.currentDate,'week');});this.setState({appointmentDates:[].concat(_toConsumableArray(this.state.appointmentDates),_toConsumableArray(newDates)),filteredAppointmentDatesByWeek:[].concat(_toConsumableArray(this.state.filteredAppointmentDatesByWeek),_toConsumableArray(filteredAppointmentDatesByWeek)),daysOfWeek:[].concat(_toConsumableArray(this.state.daysOfWeek),_toConsumableArray(this.getDaysOfTheWeek()))},function(){return _this2.setState({countOfApptInDaysOfWeek:[].concat(_toConsumableArray(_this2.state.countOfApptInDaysOfWeek),_toConsumableArray(_this2.countOfApptInDaysOfWeek(_this2.state.daysOfWeek,_this2.state.filteredAppointmentDatesByWeek)))},function(){return _this2.setState({lineChartData:_objectSpread({},_this2.setLineChartData())},function(){return _this2.getSalesForTheCurrentWeek(_this2.state.sales,_this2.state.weeklySales);});});});}},{key:\"render\",value:function render(){console.log('week appointments ',this.state.weekAppointments);console.log('week presentations ',this.state.presentations);console.log('week sales ',this.state.weeklySales);console.log('week filtered sales ',this.state.weeklyFilteredSales);return React.createElement(\"div\",{className:\"metrics-page-container\"},React.createElement(\"div\",{className:\"metrics-page\"},React.createElement(WeeklyAppointmentsMetric,{className:\"wam\",lineChartData:this.state.lineChartData}),React.createElement(WeeklyProduction,{className:\"wpm\",polarChartData:this.state.polarChartData})),React.createElement(\"div\",{className:\"ratios\"},React.createElement(\"h1\",null,\"Production\"),React.createElement(\"hr\",null),React.createElement(\"h5\",null,\"Annualized Life Premium: $\",this.state.salesAmount===0.0?'-':this.state.salesAmount.toFixed(2)),React.createElement(\"p\",null,\"Written for the week of \",moment().startOf('week').format('MM-DD'),\" \",\" through \",moment().endOf('week').format('MM-DD')),React.createElement(\"h1\",null,\"Ratios\"),React.createElement(\"hr\",null),React.createElement(\"hr\",{style:{zIndex:'5'}}),React.createElement(\"h5\",null,\"Show Ratio:\",\" \",\" \",this.state.weekAppointments.length===0?'-':(parseFloat(this.state.presentations.length/this.state.weekAppointments.length)*100).toFixed(2)+'%'),React.createElement(\"h5\",null,\"Close Ratio:\",\" \",\" \",this.state.presentations.length===0?'-':(parseFloat(this.state.weeklyFilteredSales.length/this.state.presentations.length)*100).toFixed(2)+'%')));}}]);return MetricsContainer;}(React.Component);export default MetricsContainer;","map":{"version":3,"sources":["/Users/altafquadri/Development/code/Mod5Project/Frontend/lead-us-react/src/containers/MetricsContainer.js"],"names":["React","moment","WeeklyAppointmentsMetric","WeeklyProduction","MetricsContainer","state","currentUser","sales","currentDate","appointments","appointmentDates","filteredAppointmentDatesByWeek","daysOfWeek","countOfApptInDaysOfWeek","lineChartData","weekAppointments","presentations","weeklySales","polarChartData","weeklyFilteredSales","salesAmount","getDaysOfTheWeek","beginningOfWeek","startOf","push","format","i","add","a","b","counts","length","count","j","isSame","getWeeklyPresentations","filteredAppointmentsByWeek","filter","appointment","date","salesonWeeklyAppointments","setState","setPolarChartData","presentationAppointments","setLineChartData","chartData","labels","datasets","label","data","backgroundColor","borderColor","borderWidth","getSalesForTheCurrentWeek","weekSales","weekSalesids","map","wSale","lead_id","sale","includes","reduce","total","alp","annualized_life_premium","props","newDates","console","log","toFixed","endOf","zIndex","parseFloat","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport moment from 'moment'\nimport WeeklyAppointmentsMetric from '../components/WeeklyAppointmentsMetric';\nimport WeeklyProduction from '../components/WeeklyProduction';\nimport './MetricsContainer.css'\n\nclass MetricsContainer extends React.Component {\n    state = { \n        currentUser: [],\n        sales: [],\n        currentDate: moment(),\n        appointments: [],\n        appointmentDates: [],\n        filteredAppointmentDatesByWeek: [],\n        daysOfWeek: [],\n        countOfApptInDaysOfWeek: [],\n        lineChartData: {},\n        weekAppointments: [],\n        presentations: [],\n        weeklySales: [],\n        polarChartData: {},\n        weeklyFilteredSales: [],\n        salesAmount: 0\n    }\n\n    componentDidMount() {\n        this.setState(\n            { \n                currentUser: this.props.currentUser,\n                appointments: this.props.appointments,\n                sales: this.props.sales\n                \n            }, () => this.setState({ presentations: this.getWeeklyPresentations() }))\n\n\n            let newDates, filteredAppointmentDatesByWeek\n            //take all appointments\n            newDates = this.props.appointments.map(appointment => appointment.date)\n            //take appointments and filter them by current week\n            //compare today's date with the array of appointments\n            filteredAppointmentDatesByWeek = newDates.filter(date => moment(date).isSame(this.state.currentDate, 'week'))\n            this.setState(\n                { \n                    appointmentDates: [...this.state.appointmentDates, ...newDates],\n                    filteredAppointmentDatesByWeek: [...this.state.filteredAppointmentDatesByWeek, ...filteredAppointmentDatesByWeek],\n                    daysOfWeek: [...this.state.daysOfWeek, ...this.getDaysOfTheWeek()],\n                }, () => this.setState(\n                    {\n                        countOfApptInDaysOfWeek: [...this.state.countOfApptInDaysOfWeek, ...this.countOfApptInDaysOfWeek(this.state.daysOfWeek, this.state.filteredAppointmentDatesByWeek)]  \n                    }, () => this.setState({ lineChartData: {...this.setLineChartData()}  }, () => this.getSalesForTheCurrentWeek(this.state.sales, this.state.weeklySales))))\n                \n    }\n\n    getDaysOfTheWeek = () => {\n        let beginningOfWeek = moment().startOf('week')\n        let daysOfWeek = []\n        //used knowledge of today's date and the start of the week to iterate days to the end of the week\n        daysOfWeek.push(beginningOfWeek.format('YYYY-MM-DD'))\n        for (let i = 1; i < 7; i++) {\n            daysOfWeek.push(beginningOfWeek.add(1, 'days').format('YYYY-MM-DD'))\n        }\n        return daysOfWeek\n    }\n\n    // console.log(moment().isSame(moment('2019-12-23'),'date'))\n    countOfApptInDaysOfWeek = (a, b) => {\n        let counts = []\n        for (let i = 0; i < a.length; i++) {\n            // initialize all the current week's days to a count of zero\n            let count = 0;\n            for (let j = 0; j < b.length; j++) {\n                //if there is a date that matches the current weekday, then increment that date's count by 1\n                if (moment(b[j]).isSame(moment(a[i]))) {\n                    count++\n                }\n            }\n            counts.push(count)\n        }\n        return counts\n    }\n\n    getWeeklyPresentations = () => {\n        let filteredAppointmentsByWeek = this.state.appointments.filter(appointment => moment(appointment.date).isSame(this.state.currentDate, 'week'))\n        let salesonWeeklyAppointments = filteredAppointmentsByWeek.filter(appointment => appointment['made_sale?'])\n        this.setState(\n            { \n                weekAppointments: filteredAppointmentsByWeek,\n                weeklySales: salesonWeeklyAppointments  \n            }, () => this.setState({ polarChartData: this.setPolarChartData()  }));\n        let presentationAppointments = filteredAppointmentsByWeek.filter(appointment => appointment['presentation_made?'])\n        return presentationAppointments\n    }\n\n    setLineChartData = () => {\n        const chartData = {\n            labels: this.state.daysOfWeek,\n            datasets: [\n                {\n                    label: `${this.state.filteredAppointmentDatesByWeek.length} Appointments for the week`,\n                    data: this.state.countOfApptInDaysOfWeek,\n                    backgroundColor: [\n                        'rgba(48, 1, 30, 0.4)',\n                        'rgba(54, 162, 235, 0.2)',\n                        'rgba(255, 206, 86, 0.2)',\n                        'rgba(75, 192, 192, 0.2)',\n                        'rgba(153, 102, 255, 0.2)'\n                    ],\n                    borderColor: [\n                        'rgba(255, 99, 132, 1)',\n                        'rgba(54, 162, 235, 1)',\n                        'rgba(255, 206, 86, 1)',\n                        'rgba(75, 192, 192, 1)',\n                        'rgba(153, 102, 255, 1)'\n                    ],\n                    borderWidth: 1\n                }]\n        }\n        return chartData\n    }\n\n    setPolarChartData = () => {\n        const polarChartData = {\n            labels: ['Appointments', 'Presentations', 'Sales'],\n            datasets: [\n                {\n                    label: `$Weekly Presentation`,\n                    data: [this.state.weekAppointments.length, this.state.presentations.length, this.state.weeklySales.length],\n                    backgroundColor: [\n                        'rgba(48, 1, 30, 0.8)',\n                        'rgba(80, 81, 79, 0.8)',\n                        'rgba(203, 212, 194, 0.8)',\n                        'rgba(255, 206, 86, 0.2)',\n                        'rgba(75, 192, 192, 0.2)'\n                    ],\n                    borderColor: [\n                        'rgba(255, 99, 132, 1)',\n                        'rgba(54, 162, 235, 1)',\n                        'rgba(255, 206, 86, 1)',\n                        'rgba(75, 192, 192, 1)',\n                        'rgba(153, 102, 255, 1)'\n                    ],\n                    borderWidth: 1\n                }]\n        }\n        return polarChartData\n    }\n\n    getSalesForTheCurrentWeek = (a, b) => {\n        // if (a === undefined || b === undefined) return //needed this guard condition when I had the metrics container split amongst other classes\n            let sales = a // total of all sales user has\n            let weekSales = b // all this current week sales\n            let weekSalesids = weekSales.map(wSale => wSale.lead_id) //week sales are all the appointments\n            let weeklyFilteredSales = sales.filter(sale => weekSalesids.includes(sale.lead_id)) // want all of the total sales that correspond to the week\n            this.setState({ weeklyFilteredSales: [...weeklyFilteredSales]  });\n            //sum up all the annualized life premiums for the week\n            let salesAmount = weeklyFilteredSales.reduce((total, alp)=> {\n                return total + alp.annualized_life_premium\n            }, 0)\n            this.setState({ salesAmount: salesAmount  });\n    }\n\n    render() { \n        console.log('week appointments ', this.state.weekAppointments)\n        console.log('week presentations ', this.state.presentations)\n        console.log('week sales ', this.state.weeklySales)\n        console.log('week filtered sales ', this.state.weeklyFilteredSales)\n        return ( \n            <div className=\"metrics-page-container\">\n                \n            <div className=\"metrics-page\">\n                <WeeklyAppointmentsMetric className=\"wam\" lineChartData={this.state.lineChartData}/>\n                <WeeklyProduction className=\"wpm\" polarChartData={this.state.polarChartData}/>\n            </div>\n                <div className=\"ratios\">\n                    <h1>Production</h1>\n                    <hr></hr>\n                    <h5>Annualized Life Premium: ${this.state.salesAmount === 0.0 ? '-' : this.state.salesAmount.toFixed(2)}</h5>\n                    <p>Written for the week of {moment().startOf('week').format('MM-DD')} \n                    {\" \"} through {moment().endOf('week').format('MM-DD')}</p>\n\n\n                    <h1>Ratios</h1>\n                    <hr></hr>\n                    <hr style={{zIndex: '5' }}></hr>\n                    <h5>Show Ratio:{\" \"} {this.state.weekAppointments.length === 0 ? '-' : (parseFloat(this.state.presentations.length/this.state.weekAppointments.length)*100).toFixed(2) + '%'}</h5>\n                    <h5>Close Ratio:{\" \"} {this.state.presentations.length === 0 ? '-' : (parseFloat(this.state.weeklyFilteredSales.length/this.state.presentations.length)*100).toFixed(2) + '%'}</h5>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default MetricsContainer;"]},"metadata":{},"sourceType":"module"}